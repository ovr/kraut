<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>

<script src="matrix.js"></script>
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
    tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]}
  });
</script>
<script src="bower_components/MathJax/MathJax.js"></script>

<style type="text/css">
    .not-valid {
        border: 1px solid red;
    }
    form {
        text-align: center;
        padding-top: 50px;
    }
    #calc {
        margin: 0 auto;
    }
    #output {
        width: 650px;
        margin: 0 auto;
        text-align: center;
    }
</style>

<script>
    $(document).ready(function () {
        console.log("ready!");

        function printTable($selector, size, old) {
            $selector.html('');
            var value;

            for (i = 0; i < size; i++) {
                row = $('<tr>');

                for (j = 0; j < size; j++) {
                    value = '';

                    if (old[i] != undefined) {
                        if (old[i][j] != undefined && !isNaN(old[i][j])) {
                            value = old[i][j];
                        }
                    }

                    row.append(
                            $('<td>').html(
                                    $('<input>').attr({
                                        value: value,
                                        type: "text",
                                        name: "matrix[][]"
                                    })
                            )
                    );
                }

                $selector.append(row);
            }
        }

        MATRIX_DEFAULT_SIZE = 4;

        $table = $('#calc');
        printTable($table, MATRIX_DEFAULT_SIZE, [[3,1,-1,2],[-5,1,3,-4],[2,0,1,-1],[1,-5,3,-3]]);


        function parseMatrix() {
            var matrix = [];
            $('#calc tr').each(function() {
                var elements = $('td');

                var arrElementsRow = [];
                $(this).find('td input').each(function(element) {
                    arrElementsRow.push(parseFloat($(this).val()));
                });

                matrix.push(arrElementsRow);
            });

            return matrix;
        }


        var $minusMatrixRow = $('#minusMatrixRow');

        $('#plusMatrixRow').click(function(e) {
            event.preventDefault();

            if (MATRIX_DEFAULT_SIZE == 2) {
                $minusMatrixRow.removeAttr('disabled');
            }

            MATRIX_DEFAULT_SIZE++;
            printTable($table, MATRIX_DEFAULT_SIZE, parseMatrix());
        });

        $minusMatrixRow.click(function(e) {
            event.preventDefault();

            if (MATRIX_DEFAULT_SIZE == 3) {
                $minusMatrixRow.attr('disabled', 'true');
            }

            MATRIX_DEFAULT_SIZE--;
            printTable($table, MATRIX_DEFAULT_SIZE, parseMatrix());
        });

        function buildStrMatrix(data) {
            var str = '\\begin{bmatrix} ';


            for (i = 0; i < data.length; i++) {
                for (j = 0; j < data.length; j++) {
                    str += data[i][j];

                    if (j + 1 < data.length) {
                        str += ' & ';
                    }
                }

                if (i + 1 < data.length) {
                    str += "\\\\ ";
                }
            }

            return str + ' \\end{bmatrix}';
        }

        $('#calculate').click(function(e) {
            e.preventDefault();
            $('#result').html('');

            console.log("Calculate");

            var matrix = [];
            var isValid = true;

            $('#calc tr').each(function() {
                var elements = $('td');

                var arrElementsRow = [];
                $(this).find('td input').each(function(element) {
                    var $element = $(this);

                    if ($element.val() == "") {
                        $element.addClass('not-valid');
                        isValid = false;
                    } else {
                        $element.removeClass('not-valid');
                    }

                    arrElementsRow.push(parseFloat($element.val()));
                });

                matrix.push(arrElementsRow);
            });


            if (isValid) {
                var html = "\\[A = " + buildStrMatrix(matrix) + "\\]";


                html += '\\[A = L * U\\]';

                html += '\\[ ';
                    html += "L = " + buildStrMatrix(matrix);
                    html += "U = " + buildStrMatrix(matrix);
                html += '\\]';

//                $('#result').html(matrixDet(matrix, matrix.length));
                $('#result').html(html);

                MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
            } else {

            }
        })
    });
</script>

<form>
    <button id="plusMatrixRow">+1</button>
    <button id="minusMatrixRow">-1</button>
    <table id="calc"></table>
    <button id="calculate">Посчитать</button>
    <div id="result">
        \[A = \begin{bmatrix} 3 & 1 & -1 & 2 \\ -5 & 1 & 3 & -4 \\ 2 & 0 & 1 & -1 \\ 1 & -5 & 3 & -3 \end{bmatrix}\]


        \[A = L * U\]

        \[
            L = \begin{bmatrix} 3 & 0 & 0 & 0 \\ -5 & 2.6667 & 0 & 0 \\ 2 & -0.6667 & 2 & 0 \\ 1 & -5.3333 & 6 & 2.5 \end{bmatrix}
            U = \begin{bmatrix} 1 & 0.3333 & -0.333 & 0.6667 \\ 0 & 1 & 0.5 & -0.25 \\ 0 & 0 & 1 & 5 \\ 0 & 0 & 0 & 1 \end{bmatrix}
        \]
    </div>
</form>

</body>
</html>